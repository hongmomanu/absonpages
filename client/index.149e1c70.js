import{S as e,i as t,s as n,e as s,t as a,c as l,b as r,d as i,f as o,g as m,h as c,C as g,j as p,k as u,v as d,a as h,n as f,D as w,E as x,F as v,G as y}from"./index.8fca06d2.js";import{g as k,a as D,m as b,b as C,F}from"./util.c3d26849.js";const{Object:q}=y;function j(e,t,n){const s=q.create(e);return s.name=t[n].name,s.time=t[n].time,s.kind=t[n].kind,s.filename=t[n].filename,s.i=n,s}function S(e){var t,n,h,f,w,x,v=e.name+"",y=e.time+"";function k(){return e.dblclick_handler(e)}return{c(){t=s("div"),n=a(v),h=a(":"),f=a(y),this.h()},l(e){t=l(e,"DIV",{class:!0},!1);var s=r(t);n=i(s,v),h=i(s,":"),f=i(s,y),s.forEach(o),this.h()},h(){m(t,"class",w=c(e.kind)+" svelte-1k2w85n"),x=g(t,"dblclick",k)},m(e,s){p(e,t,s),u(t,n),u(t,h),u(t,f)},p(s,a){e=a,s.messages&&v!==(v=e.name+"")&&d(n,v),s.messages&&y!==(y=e.time+"")&&d(f,y),s.messages&&w!==(w=c(e.kind)+" svelte-1k2w85n")&&m(t,"class",w)},d(e){e&&o(t),x()}}}function _(e){for(var t,n,c,x,v,y,k,D,b,C,F,q=e.messages,_=[],E=0;E<q.length;E+=1)_[E]=S(j(e,q,E));return{c(){t=h(),n=s("button"),c=a("import hardware excel file"),x=h(),v=s("input"),y=h(),k=s("span"),D=a(e.filename),b=h(),C=s("div");for(var l=0;l<_.length;l+=1)_[l].c();this.h()},l(s){t=i(s,"\n\n"),n=l(s,"BUTTON",{class:!0},!1);var a=r(n);c=i(a,"import hardware excel file"),a.forEach(o),x=i(s,"\n"),v=l(s,"INPUT",{type:!0,accept:!0,class:!0},!1),r(v).forEach(o),y=i(s,"\n"),k=l(s,"SPAN",{},!1);var m=r(k);D=i(m,e.filename),m.forEach(o),b=i(s,"\n\n"),C=l(s,"DIV",{class:!0},!1);for(var g=r(C),p=0;p<_.length;p+=1)_[p].l(g);g.forEach(o),this.h()},h(){document.title="Daisy’s hardware order generate",m(n,"class","pure-button pure-button-primary"),m(v,"type","file"),m(v,"accept","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),m(v,"class","svelte-1k2w85n"),m(C,"class","msg svelte-1k2w85n"),F=g(n,"click",e.openFileDialog)},m(s,a){p(s,t,a),p(s,n,a),u(n,c),p(s,x,a),p(s,v,a),e.input_binding(v),p(s,y,a),p(s,k,a),u(k,D),p(s,b,a),p(s,C,a);for(var l=0;l<_.length;l+=1)_[l].m(C,null)},p(e,t){if(e.filename&&d(D,t.filename),e.messages){q=t.messages;for(var n=0;n<q.length;n+=1){const s=j(t,q,n);_[n]?_[n].p(e,s):(_[n]=S(s),_[n].c(),_[n].m(C,null))}for(;n<_.length;n+=1)_[n].d(1);_.length=q.length}},i:f,o:f,d(s){s&&(o(t),o(n),o(x),o(v)),e.input_binding(null),s&&(o(y),o(k),o(b),o(C)),w(_,s),F()}}}function E(e,t,n){let s,a="",l=[];return x(()=>{s.onchange=(e=>{const t={},s=e.target.files[0],{path:r,name:i}=s,{app:o}=require("electron").remote;console.log("path",r,s);const m=require("fs"),c=require("path"),g=require("pizzip"),p=require("exceljs/modern.nodejs"),u=require("docxtemplater"),d=o.getPath("desktop");n("filename",a=i);var h=c.resolve(o.getAppPath(),"templatehardware.docx"),f=new g(m.readFileSync(h,"binary")),w=new u;w.setOptions({linebreaks:!0}),w.loadZip(f);var x=new p.Workbook;l.push({name:"正在读取文件。。。",time:new Date}),n("messages",l),x.xlsx.readFile(r).then(function(){var e=x.getWorksheet("Disp w.34");if(!e)return alert("excel里面缺少页面 Disp w.34"),void n("messages",l=[{name:"excel里面缺少页面 Disp w.34",time:new Date}]);for(var s in l.push({name:"读取文件成功。",time:new Date}),n("messages",l),e.eachRow(function(e,n){if(n>2){const n=e.getCell(13),s=k(),a=(new Date).getFullYear(),l=D(n,s>n?a+1:a);if(!e.getCell(2).text)return;const r={ponum:e.getCell(2).text.substr(2),ponumstr:e.getCell(2).text,order:e.getCell(1).text,jworder:e.getCell(3).text,itemno:e.getCell(5).text,day:b(l.getDate()),month:b(l.getMonth()+1),year:b(l.getFullYear()),monthstr:l.toDateString().split(" ")[1],dest:e.getCell(4).text,destZh:C(e.getCell(4).text.split(",")[1].replace(/ /g,"")),description:e.getCell(6).text,amount:e.getCell(7).text,price:e.getCell(15).text,money:(e.getCell(7).text*e.getCell(15).text).toFixed(2),nowyear:b((new Date).getFullYear()),nowmonth:b((new Date).getMonth()+1),nowday:b((new Date).getDate())};r.during=F[r.itemno][0],r.seller=F[r.itemno][1],r.sellerzh=F[r.itemno][2],r.address=F[r.itemno][3],r.addresszh=F[r.itemno][4],r.tel=F[r.itemno][5],r.packing=F[r.itemno][6],r.sellerAgency=F[r.itemno][7]?`\n${F[r.itemno][7]}\n`:"",t[e.getCell(2).text]?(t[r.ponumstr].totalmoney+=1*r.money,t[r.ponumstr].clients.push(r)):(t[r.ponumstr]=Object.assign({},r),t[r.ponumstr].totalmoney=1*r.money,t[r.ponumstr].clients=[r])}}),t){t[s].totalmoney=t[s].totalmoney.toFixed(2),w.setData(t[s]);const e=`${s}_${t[s].nowyear}_${t[s].nowmonth}_${t[s].nowday}.docx`;try{w.render()}catch(e){var a={message:e.message,name:e.name,stack:e.stack,properties:e.properties};throw console.log(JSON.stringify({error:a})),e}var r=w.getZip().generate({type:"nodebuffer"});const i=c.resolve(d,"Abson");m.existsSync(i)||m.mkdirSync(i);const o=c.resolve(i,e);try{m.writeFileSync(o,r),l.push({name:`${e} 已成功！`,time:new Date,kind:"filesuc",filename:e}),n("messages",l)}catch(a){l.push({name:`${e} 文件已打开,生成失败`,time:new Date}),n("messages",l)}}l.push({name:"全部结束",time:new Date}),n("messages",l)})}),n("filedialog",s)}),{filedialog:s,filename:a,messages:l,openFileDialog:function(){s.value="",n("filedialog",s),s.click()},input_binding:function(e){v[e?"unshift":"push"](()=>{n("filedialog",s=e)})},dblclick_handler:function({filename:e}){return function(e){const{app:t}=require("electron").remote,n=require("path"),s=t.getPath("desktop"),a=n.resolve(s,"Abson",e),{shell:l}=require("electron");l.openExternal(a)}(e)}}}export default class extends e{constructor(e){super(),t(this,e,E,_,n,[])}}
