import{S as e,i as t,s as n,e as a,t as s,c as r,b as l,d as i,f as o,g as m,h as c,C as d,j as g,k as p,v as u,a as f,n as h,D as w,E as x,F as v,G as y}from"./index.8fca06d2.js";import"./index.c7fced0c.js";import{s as k,g as D,a as b,m as C,b as F,F as j}from"./util.48aeca72.js";const{Object:q}=y;function S(e,t,n){const a=q.create(e);return a.name=t[n].name,a.time=t[n].time,a.kind=t[n].kind,a.filename=t[n].filename,a.i=n,a}function _(e){var t,n,f,h,w,x,v=e.name+"",y=e.time+"";function k(){return e.dblclick_handler(e)}return{c(){t=a("div"),n=s(v),f=s(":"),h=s(y),this.h()},l(e){t=r(e,"DIV",{class:!0},!1);var a=l(t);n=i(a,v),f=i(a,":"),h=i(a,y),a.forEach(o),this.h()},h(){m(t,"class",w=c(e.kind)+" svelte-1k2w85n"),x=d(t,"dblclick",k)},m(e,a){g(e,t,a),p(t,n),p(t,f),p(t,h)},p(a,s){e=s,a.messages&&v!==(v=e.name+"")&&u(n,v),a.messages&&y!==(y=e.time+"")&&u(h,y),a.messages&&w!==(w=c(e.kind)+" svelte-1k2w85n")&&m(t,"class",w)},d(e){e&&o(t),x()}}}function E(e){for(var t,n,c,x,v,y,k,D,b,C,F,j=e.messages,q=[],E=0;E<j.length;E+=1)q[E]=_(S(e,j,E));return{c(){t=f(),n=a("button"),c=s("import hardware excel file"),x=f(),v=a("input"),y=f(),k=a("span"),D=s(e.filename),b=f(),C=a("div");for(var r=0;r<q.length;r+=1)q[r].c();this.h()},l(a){t=i(a,"\n\n"),n=r(a,"BUTTON",{class:!0},!1);var s=l(n);c=i(s,"import hardware excel file"),s.forEach(o),x=i(a,"\n"),v=r(a,"INPUT",{type:!0,accept:!0,class:!0},!1),l(v).forEach(o),y=i(a,"\n"),k=r(a,"SPAN",{},!1);var m=l(k);D=i(m,e.filename),m.forEach(o),b=i(a,"\n\n"),C=r(a,"DIV",{class:!0},!1);for(var d=l(C),g=0;g<q.length;g+=1)q[g].l(d);d.forEach(o),this.h()},h(){document.title="Daisy’s hardware order generate",m(n,"class","pure-button pure-button-primary"),m(v,"type","file"),m(v,"accept","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),m(v,"class","svelte-1k2w85n"),m(C,"class","msg svelte-1k2w85n"),F=d(n,"click",e.openFileDialog)},m(a,s){g(a,t,s),g(a,n,s),p(n,c),g(a,x,s),g(a,v,s),e.input_binding(v),g(a,y,s),g(a,k,s),p(k,D),g(a,b,s),g(a,C,s);for(var r=0;r<q.length;r+=1)q[r].m(C,null)},p(e,t){if(e.filename&&u(D,t.filename),e.messages){j=t.messages;for(var n=0;n<j.length;n+=1){const a=S(t,j,n);q[n]?q[n].p(e,a):(q[n]=_(a),q[n].c(),q[n].m(C,null))}for(;n<q.length;n+=1)q[n].d(1);q.length=j.length}},i:h,o:h,d(a){a&&(o(t),o(n),o(x),o(v)),e.input_binding(null),a&&(o(y),o(k),o(b),o(C)),w(q,a),F()}}}function $(e,t,n){let a,s="",r=[];k.subscribe(e=>{n("messages",r=e)});return x(()=>{a.onchange=(e=>{const t={},a=e.target.files[0],{path:r,name:l}=a,{app:i}=require("electron").remote;console.log("path",r,a);const o=require("fs"),m=require("path"),c=require("pizzip"),d=require("exceljs/modern.nodejs"),g=require("docxtemplater"),p=i.getPath("desktop");n("filename",s=l);var u=m.resolve(i.getAppPath(),"templatehardware.docx"),f=new c(o.readFileSync(u,"binary")),h=new g;h.setOptions({linebreaks:!0}),h.loadZip(f);var w=new d.Workbook;k.addmsg({name:"正在读取文件。。。",time:new Date}),w.xlsx.readFile(r).then(function(){var e=w.getWorksheet("Disp w.34");if(!e)return alert("excel里面缺少页面 Disp w.34"),void k.reset([{name:"excel里面缺少页面 Disp w.34",time:new Date}]);for(var n in k.addmsg({name:"读取文件成功。",time:new Date}),e.eachRow(function(e,n){if(n>2){const n=e.getCell(13),a=D(),s=(new Date).getFullYear(),r=b(n,a>n?s+1:s);if(!e.getCell(2).text)return;const l={ponum:e.getCell(2).text.substr(2),ponumstr:e.getCell(2).text,order:e.getCell(1).text,jworder:e.getCell(3).text,itemno:e.getCell(5).text,day:C(r.getDate()),month:C(r.getMonth()+1),year:C(r.getFullYear()),monthstr:r.toDateString().split(" ")[1],dest:e.getCell(4).text,destZh:F(e.getCell(4).text.split(",")[1].replace(/ /g,"")),description:e.getCell(6).text,amount:e.getCell(7).text,price:e.getCell(15).text,money:(e.getCell(7).text*e.getCell(15).text).toFixed(2),nowyear:C((new Date).getFullYear()),nowmonth:C((new Date).getMonth()+1),nowday:C((new Date).getDate())};l.during=j[l.itemno][0],l.seller=j[l.itemno][1],l.sellerzh=j[l.itemno][2],l.address=j[l.itemno][3],l.addresszh=j[l.itemno][4],l.tel=j[l.itemno][5],l.packing=j[l.itemno][6],l.sellerAgency=j[l.itemno][7]?`\n${j[l.itemno][7]}\n`:"",t[e.getCell(2).text]?(t[l.ponumstr].totalmoney+=1*l.money,t[l.ponumstr].clients.push(l)):(t[l.ponumstr]=Object.assign({},l),t[l.ponumstr].totalmoney=1*l.money,t[l.ponumstr].clients=[l])}}),t){t[n].totalmoney=t[n].totalmoney.toFixed(2),h.setData(t[n]);const e=`${n}_${t[n].nowyear}_${t[n].nowmonth}_${t[n].nowday}.docx`;try{h.render()}catch(e){var a={message:e.message,name:e.name,stack:e.stack,properties:e.properties};throw console.log(JSON.stringify({error:a})),e}var s=h.getZip().generate({type:"nodebuffer"});const r=m.resolve(p,"Abson");o.existsSync(r)||o.mkdirSync(r);const l=m.resolve(r,e);try{o.writeFileSync(l,s),k.addmsg({name:`${e} 已成功！`,time:new Date,kind:"filesuc",filename:e})}catch(a){k.addmsg({name:`${e} 文件已打开,生成失败`,time:new Date})}}k.addmsg({name:"全部结束",time:new Date}),k.addmsg({name:"--------------------------------分割綫",time:"分割綫--------------------------------"})})}),n("filedialog",a)}),{filedialog:a,filename:s,messages:r,openFileDialog:function(){a.value="",n("filedialog",a),a.click()},input_binding:function(e){v[e?"unshift":"push"](()=>{n("filedialog",a=e)})},dblclick_handler:function({filename:e}){return function(e){const{app:t}=require("electron").remote,n=require("path"),a=t.getPath("desktop"),s=n.resolve(a,"Abson",e),{shell:r}=require("electron");r.openExternal(s)}(e)}}}export default class extends e{constructor(e){super(),t(this,e,$,E,n,[])}}
