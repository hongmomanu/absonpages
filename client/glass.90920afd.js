import{S as e,i as t,s as n,e as a,t as s,c as l,b as r,d as o,f as i,g as c,h as m,C as g,j as d,k as u,v as p,a as f,n as h,D as x,E as v,F as w,G as y}from"./index.8fca06d2.js";import"./index.c7fced0c.js";import{s as k,g as b,a as D,m as C}from"./util.48aeca72.js";const{Object:F}=y;function j(e,t,n){const a=F.create(e);return a.name=t[n].name,a.time=t[n].time,a.kind=t[n].kind,a.filename=t[n].filename,a.i=n,a}function q(e){var t,n,f,h,x,v,w=e.name+"",y=e.time+"";function k(){return e.dblclick_handler(e)}return{c(){t=a("div"),n=s(w),f=s(":"),h=s(y),this.h()},l(e){t=l(e,"DIV",{class:!0},!1);var a=r(t);n=o(a,w),f=o(a,":"),h=o(a,y),a.forEach(i),this.h()},h(){c(t,"class",x=m(e.kind)+" svelte-1k2w85n"),v=g(t,"dblclick",k)},m(e,a){d(e,t,a),u(t,n),u(t,f),u(t,h)},p(a,s){e=s,a.messages&&w!==(w=e.name+"")&&p(n,w),a.messages&&y!==(y=e.time+"")&&p(h,y),a.messages&&x!==(x=m(e.kind)+" svelte-1k2w85n")&&c(t,"class",x)},d(e){e&&i(t),v()}}}function S(e){for(var t,n,m,v,w,y,k,b,D,C,F,S=e.messages,_=[],E=0;E<S.length;E+=1)_[E]=q(j(e,S,E));return{c(){t=f(),n=a("button"),m=s("import glass excel file"),v=f(),w=a("input"),y=f(),k=a("span"),b=s(e.filename),D=f(),C=a("div");for(var l=0;l<_.length;l+=1)_[l].c();this.h()},l(a){t=o(a,"\n\n"),n=l(a,"BUTTON",{class:!0},!1);var s=r(n);m=o(s,"import glass excel file"),s.forEach(i),v=o(a,"\n\n"),w=l(a,"INPUT",{type:!0,accept:!0,class:!0},!1),r(w).forEach(i),y=o(a,"\n"),k=l(a,"SPAN",{},!1);var c=r(k);b=o(c,e.filename),c.forEach(i),D=o(a,"\n\n"),C=l(a,"DIV",{class:!0},!1);for(var g=r(C),d=0;d<_.length;d+=1)_[d].l(g);g.forEach(i),this.h()},h(){document.title="Daisy’s glass order generate",c(n,"class","pure-button pure-button-primary"),c(w,"type","file"),c(w,"accept","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),c(w,"class","svelte-1k2w85n"),c(C,"class","msg svelte-1k2w85n"),F=g(n,"click",e.openFileDialog)},m(a,s){d(a,t,s),d(a,n,s),u(n,m),d(a,v,s),d(a,w,s),e.input_binding(w),d(a,y,s),d(a,k,s),u(k,b),d(a,D,s),d(a,C,s);for(var l=0;l<_.length;l+=1)_[l].m(C,null)},p(e,t){if(e.filename&&p(b,t.filename),e.messages){S=t.messages;for(var n=0;n<S.length;n+=1){const a=j(t,S,n);_[n]?_[n].p(e,a):(_[n]=q(a),_[n].c(),_[n].m(C,null))}for(;n<_.length;n+=1)_[n].d(1);_.length=S.length}},i:h,o:h,d(a){a&&(i(t),i(n),i(v),i(w)),e.input_binding(null),a&&(i(y),i(k),i(D),i(C)),x(_,a),F()}}}function _(e,t,n){let a,s="",l=[];k.subscribe(e=>{n("messages",l=e)});return v(()=>{a.onchange=(e=>{const t={},a=e.target.files[0],{path:l,name:r}=a,{app:o}=require("electron").remote;console.log("path",l,a);const i=require("fs"),c=require("path"),m=require("pizzip"),g=require("exceljs/modern.nodejs"),d=require("docxtemplater"),u=o.getPath("desktop");n("filename",s=r);var p=c.resolve(o.getAppPath(),"templateglass.docx"),f=new m(i.readFileSync(p,"binary")),h=new d;h.setOptions({linebreaks:!0}),h.loadZip(f);var x=new g.Workbook;k.addmsg({name:"正在读取文件。。。",time:new Date}),x.xlsx.readFile(l).then(function(){var e=x.getWorksheet("13257");if(!e)return alert("excel里面缺少页面 13257"),void k.reset([{name:"excel里面缺少页面 13257",time:new Date}]);for(var n in k.addmsg({name:"读取文件成功。",time:new Date}),e.eachRow(function(e,n){if(n>4){const n=e.getCell(8),a=b(),s=(new Date).getFullYear(),l=D(n,a>n?s+1:s);if(!e.getCell(2).text)return;const r={ponum:e.getCell(2).text.substr(2),ponumstr:e.getCell(2).text,order:e.getCell(1).text,jworder:e.getCell(3).text,itemno:e.getCell(4).text,day:C(l.getDate()),month:C(l.getMonth()+1),year:C(l.getFullYear()),monthstr:l.toDateString().split(" ")[1],description:e.getCell(10).text,amount:e.getCell(11).text,price:(1*e.getCell(13).text).toFixed(3),money:(e.getCell(11).text*e.getCell(13).text).toFixed(3),nowyear:C((new Date).getFullYear()),nowmonth:C((new Date).getMonth()+1),nowday:C((new Date).getDate()),packing:e.getCell(20).text,customernum:e.getCell(5).text};t[e.getCell(2).text]?(t[r.ponumstr].totalmoney+=1*r.money,t[r.ponumstr].clients.push(r)):(t[r.ponumstr]=Object.assign({},r),t[r.ponumstr].totalmoney=1*r.money,t[r.ponumstr].clients=[r])}}),t){t[n].totalmoney=t[n].totalmoney.toFixed(3),h.setData(t[n]);const e=`${n}_${t[n].nowyear}_${t[n].nowmonth}_${t[n].nowday}.docx`;try{h.render()}catch(e){var a={message:e.message,name:e.name,stack:e.stack,properties:e.properties};throw console.log(JSON.stringify({error:a})),e}var s=h.getZip().generate({type:"nodebuffer"});const l=c.resolve(u,"Abson");i.existsSync(l)||i.mkdirSync(l);const r=c.resolve(l,e);try{i.writeFileSync(r,s),k.addmsg({name:`${e} 已成功！`,time:new Date,kind:"filesuc",filename:e})}catch(a){k.addmsg({name:`${e} 文件已打开,生成失败`,time:new Date})}}k.addmsg({name:"全部结束",time:new Date}),k.addmsg({name:"--------------------------------分割綫",time:"分割綫--------------------------------"})})}),n("filedialog",a)}),{filedialog:a,filename:s,messages:l,openFileDialog:function(){a.value="",n("filedialog",a),a.click()},input_binding:function(e){w[e?"unshift":"push"](()=>{n("filedialog",a=e)})},dblclick_handler:function({filename:e}){return function(e){const{app:t}=require("electron").remote,n=require("path"),a=t.getPath("desktop"),s=n.resolve(a,"Abson",e),{shell:l}=require("electron");l.openExternal(s)}(e)}}}export default class extends e{constructor(e){super(),t(this,e,_,S,n,[])}}
